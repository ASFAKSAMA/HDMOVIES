<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial,sans-serif; background:#f4f6f9; padding:20px;}
    h2 { text-align:center; }
    .user-card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.1); margin-bottom:15px; display:flex; align-items:center; gap:15px;}
    .user-card img { width:80px; height:80px; object-fit:cover; border-radius:6px;}
    .user-info { flex:1; }
    .user-info input, .user-info textarea { width:100%; margin:3px 0; padding:5px; border-radius:5px; border:1px solid #ccc;}
    .btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; margin-top:5px;}
    .btn-edit { background:#28a745; color:#fff; }
    .btn-delete { background:#dc3545; color:#fff; }
    .hidden{ display: none; }
  </style>
</head>
<body>

<h2>Admin Panel - All Users</h2>
<div id="usersContainer"></div>

<script>
// ----------- Admin protection -------------
const adminUsername = "jiya";
const adminPassword = "Asfak1706";

let inputUsername = prompt("Enter admin username:");
let inputPassword = prompt("Enter admin password:");

if(inputUsername !== adminUsername || inputPassword !== adminPassword){
  alert("Access denied! Incorrect username or password.");
  document.body.innerHTML = "<h2>Access Denied</h2>";
  throw new Error("Unauthorized access");
}
// ----------- End protection ---------------

// -------------------------
// API URL (replace with real one)
const apiUrl = "https://exquisite-fenglisu-981b34.netlify.app"; // replace this with your real API endpoint

// Store users locally after fetching
let users = [];

// -------------------------
// FETCH USERS FROM API
// -------------------------
function fetchUsers() {
  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      users = data; // store fetched users
      renderUsers();
    })
    .catch(err => {
      console.error("Failed to fetch users:", err);
      document.getElementById('usersContainer').innerHTML = "<p>Failed to fetch users.</p>";
    });
}

// -------------------------
// RENDER USERS
// -------------------------
const usersContainer = document.getElementById('usersContainer');

function renderUsers() {
  usersContainer.innerHTML = '';
  users.forEach((user, index) => {
    const div = document.createElement('div');
    div.className = 'user-card';
    div.innerHTML = `
      <img src="${user.photo || 'https://via.placeholder.com/80'}" alt="Photo">
      <div class="user-info">
        <input type="text" value="${user.name}" placeholder="Full Name" id="name${index}">
        <input type="text" value="${user.username}" placeholder="Username" id="username${index}">
        <input type="text" value="${user.password}" placeholder="Password" id="password${index}">
        <textarea rows="2" placeholder="Bio" id="bio${index}">${user.bio || ''}</textarea>
        <button class="btn btn-edit" onclick="editUser(${index})">Save</button>
        <button class="btn btn-delete" onclick="deleteUser(${index})">Delete</button>
      </div>
    `;
    usersContainer.appendChild(div);
  });
}

// -------------------------
// EDIT USER
// -------------------------
function editUser(index) {
  const name = document.getElementById(`name${index}`).value.trim();
  const username = document.getElementById(`username${index}`).value.trim();
  const password = document.getElementById(`password${index}`).value;
  const bio = document.getElementById(`bio${index}`).value.trim();

  if(!name || !username || !password){ alert('Name, username, and password required'); return; }

  // Update local array
  users[index] = {...users[index], name, username, password, bio};

  // Send PUT request to API (replace with your API)
  fetch(`${apiUrl}/${users[index].id}`, {
    method: "PUT",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(users[index])
  })
  .then(res => res.json())
  .then(data => {
    alert("User updated!");
    renderUsers();
  })
  .catch(err => {
    console.error(err);
    alert("Failed to update user on server.");
  });
}

// -------------------------
// DELETE USER
// -------------------------
function deleteUser(index) {
  if(confirm(`Delete user "${users[index].username}"?`)){
    const userId = users[index].id;

    // Delete from server
    fetch(`${apiUrl}/${userId}`, { method: "DELETE" })
      .then(res => res.json())
      .then(() => {
        users.splice(index,1);
        renderUsers();
        alert("User deleted!");
      })
      .catch(err => {
        console.error(err);
        alert("Failed to delete user from server.");
      });
  }
}

// -------------------------
// INITIAL FETCH
fetchUsers();
</script>
</body>
</html>
