<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial,sans-serif; background:#f4f6f9; padding:20px;}
    h2 { text-align:center; }
    .user-card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.1); margin-bottom:15px; display:flex; align-items:center; gap:15px;}
    .user-card img { width:80px; height:80px; object-fit:cover; border-radius:6px;}
    .user-info { flex:1; }
    .user-info input, .user-info textarea { width:100%; margin:3px 0; padding:5px; border-radius:5px; border:1px solid #ccc;}
    .btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; margin-top:5px;}
    .btn-edit { background:#28a745; color:#fff; }
    .btn-delete { background:#dc3545; color:#fff; }
    .hidden{ display: none; }
  </style>
</head>
<body>

<h2>Admin Panel - All Users</h2>
<button id="btn-pass" onclick="showText()">Users</button>
<div id="usersContainer" class="hidden"></div>

<script>
// ----------- Admin protection -------------
const adminUsername = "jiya";
const adminPassword = "Asfak1706";

let inputUsername = prompt("Enter admin username:");
let inputPassword = prompt("Enter admin password:");

if(inputUsername !== adminUsername || inputPassword !== adminPassword){
  alert("Access denied! Incorrect username or password.");
  document.body.innerHTML = "<h2>Access Denied</h2>";
  throw new Error("Unauthorized access");
}
// ----------- End protection ---------------

function showText() {
  const element = document.getElementById('usersContainer');
  element.classList.remove('hidden');
}

// -------------------------
// GLOBAL VARIABLES
// -------------------------
let users = JSON.parse(localStorage.getItem('users') || '[]');
let signupData = {};

// References
const signupPage = document.getElementById('signupPage');
const loginPage = document.getElementById('loginPage');
const signupPhoto = document.getElementById('signupPhoto');
const signupPreview = document.getElementById('signupPreview');
const loginBtn = document.getElementById('loginBtn');
const loginError = document.getElementById('loginError');

// -------------------------
// SIGNUP PHOTO PREVIEW
// -------------------------
if (signupPhoto) {
  signupPhoto.onchange = e => {
    if(e.target.files && e.target.files[0]){
      let reader = new FileReader();
      reader.onload = ev => {
        signupPreview.src = ev.target.result;
        signupPreview.classList.remove('hidden');
        signupPhoto._base = ev.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    }
  };
}

// -------------------------
// SIGNUP STEP-BY-STEP
// -------------------------
function nextStep(step){
  switch(step){
    case 1:
      let name = document.getElementById('signupName').value.trim();
      if(!name){ alert('Enter name'); return; }
      signupData.name = name;
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
      break;
    case 2:
      let username = document.getElementById('signupUsername').value.trim();
      if(!username){ alert('Enter username'); return; }
      if(!/^[a-z0-9_]+$/.test(username)){ alert('Only letters, numbers, _ allowed'); return; }
      if(users.some(u => u.username === username)){ alert('Username exists'); return; }
      signupData.username = username;
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.remove('hidden');
      break;
    case 3:
      let password = document.getElementById('signupPassword').value;
      if(!password){ alert('Enter password'); return; }
      signupData.password = password;
      document.getElementById('step3').classList.add('hidden');
      document.getElementById('step4').classList.remove('hidden');
      break;
    case 4:
      let bio = document.getElementById('signupBio').value.trim();
      signupData.bio = bio;
      document.getElementById('step4').classList.add('hidden');
      document.getElementById('step5').classList.remove('hidden');
      break;
  }
}

function finishSignup(){
  let photo = signupPhoto._base || '';
  signupData.photo = photo;

  users.push(signupData);
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(signupData));

  alert('Signup successful!');
  window.location.href = 'dashboard.html'; // redirect to dashboard/admin
}

// -------------------------
// LOGIN
// -------------------------
if(loginBtn){
  loginBtn.onclick = () => {
    let username = document.getElementById('loginUsername').value.trim();
    let password = document.getElementById('loginPassword').value;

    // Refresh users from localStorage to get latest changes
    users = JSON.parse(localStorage.getItem('users') || '[]');

    let found = users.find(u => u.username === username && u.password === password);
    if(found){
      localStorage.setItem('currentUser', JSON.stringify(found));
      if(loginPage) loginPage.classList.add('hidden');
      alert('Login successful with updated password!');
      window.location.href = 'dashboard.html'; // redirect to dashboard/admin
    } else {
      if(loginError) loginError.classList.remove('hidden');
    }
  };
}

// -------------------------
// DASHBOARD / ADMIN PANEL
// -------------------------
const usersContainer = document.getElementById('usersContainer');
if(usersContainer){
  function renderUsers() {
    usersContainer.innerHTML = '';
    users.forEach((user, index) => {
      const div = document.createElement('div');
      div.className = 'user-card';
      div.innerHTML = `
        <img src="${user.photo || 'https://via.placeholder.com/80'}" alt="Photo">
        <div class="user-info">
          <input type="text" value="${user.name}" placeholder="Full Name" id="name${index}">
          <input type="text" value="${user.username}" placeholder="Username" id="username${index}">
          <input type="text" value="${user.password}" placeholder="Password" id="password${index}">
          <textarea rows="2" placeholder="Bio" id="bio${index}">${user.bio || ''}</textarea>
          <button class="btn btn-edit" onclick="editUser(${index})">Save</button>
          <button class="btn btn-delete" onclick="deleteUser(${index})">Delete</button>
        </div>
      `;
      usersContainer.appendChild(div);
    });
  }

  function editUser(index) {
    const name = document.getElementById(`name${index}`).value.trim();
    const username = document.getElementById(`username${index}`).value.trim();
    const password = document.getElementById(`password${index}`).value;
    const bio = document.getElementById(`bio${index}`).value.trim();

    if(!name || !username || !password){ alert('Name, username, and password required'); return; }

    if(users.some((u,i)=> u.username === username && i!==index)){
      alert('Username already exists'); 
      return; 
    }

    users[index] = {...users[index], name, username, password, bio};
    localStorage.setItem('users', JSON.stringify(users));

    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if(currentUser && currentUser.username === users[index].username){
      localStorage.setItem('currentUser', JSON.stringify(users[index]));
    }

    alert('User updated!');
    renderUsers();
  }

  function deleteUser(index) {
    if(confirm(`Delete user "${users[index].username}"?`)){
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if(currentUser && currentUser.username === users[index].username){
        localStorage.removeItem('currentUser');
      }
      users.splice(index,1);
      localStorage.setItem('users', JSON.stringify(users));
      renderUsers();
    }
  }

  renderUsers();
}
</script>
</body>
	</html>
